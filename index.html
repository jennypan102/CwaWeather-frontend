<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>èŠ±èŠ±å ±æ°£è±¡</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --pink-morning: #FFD3E2;
      --pink-noon: #FFB6C1;
      --pink-afternoon: #FF99C8;
      --pink-evening: #FF4D6D;
      --cream: #FFF0F5;
      --brown: #7A4B5A;
      --text-dark: #5C2C3B;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Zen Maru Gothic', sans-serif;
      background-color: var(--pink-morning);
      background: linear-gradient(to bottom, var(--pink-morning), var(--pink-morning));
      min-height: 100vh;
      color: var(--text-dark);
      overflow-x: hidden;
      padding-bottom: 20px;
      transition: background 1s ease-in-out;
      position: relative;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .location-pill {
      background: var(--pink-noon);
      color: var(--brown);
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 900;
      font-size: 1.1rem;
      transform: rotate(-2deg);
      border: 2px solid white;
      box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
    }

    .update-pill {
      font-size: 0.8rem;
      color: white;
      background: rgba(0, 0, 0, 0.2);
      padding: 4px 10px;
      border-radius: 12px;
    }

    .container {
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
    }

    .hero-card {
      background: var(--cream);
      border-radius: 35px;
      padding: 30px 25px;
      text-align: center;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      border: 4px solid white;
      margin-bottom: 25px;
      position: relative;
    }

    .hero-period {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--pink-evening);
      color: white;
      padding: 5px 20px;
      border-radius: 20px;
      font-weight: bold;
      border: 3px solid white;
      box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
    }

    .hero-temp-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 15px 0;
    }

    .hero-icon {
      font-size: 5rem;
      filter: drop-shadow(0 4px 0 rgba(0, 0, 0, 0.1));
      animation: float 3s infinite alternate;
      position: relative;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0); }
    }

    .hero-temp { font-size: 4.5rem; font-weight: 900; color: var(--brown); line-height: 1; }

    .hero-desc { font-size: 1.5rem; color: #9B5F7A; margin-bottom: 20px; font-weight: bold; }

    .advice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; padding-top: 20px; border-top: 2px dashed #FFB6C1; }

    .advice-item { display: flex; flex-direction: column; align-items: center; background: rgba(255, 182, 193, 0.5); padding: 10px; border-radius: 20px; }

    .advice-icon { font-size: 2rem; margin-bottom: 5px; animation: float 2s infinite alternate; }
    .advice-text { font-size: 1.4rem; font-weight: 900; color: var(--brown); margin: 5px 0; line-height: 1.2; }

    .section-title { font-size: 1.2rem; color: var(--pink-evening); margin-bottom: 15px; margin-left: 10px; font-weight: 900; text-shadow: 1px 1px 0 rgba(0,0,0,0.1); }

    .scroll-container { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 10px; scrollbar-width: none; -ms-overflow-style: none; }
    .scroll-container::-webkit-scrollbar { display: none; }

    .mini-card { min-width: 140px; background: rgba(255, 192, 203, 0.85); border-radius: 25px; padding: 20px 15px; text-align: center; border: 3px solid white; flex-shrink: 0; }
    .mini-time { background: var(--pink-noon); color: white; padding: 3px 10px; border-radius: 10px; font-size: 0.8rem; display: inline-block; margin-bottom: 10px; font-weight: bold; }
    .mini-icon { font-size: 2.5rem; margin: 5px 0; animation: float 3s infinite alternate; }

    .flower-particle { position: fixed; font-size: 1.2rem; color: #FFC0CB; pointer-events: none; user-select: none; z-index: 1; opacity: 0.8; }

    .loading-screen { position: fixed; top:0; left:0; right:0; bottom:0; background: var(--pink-morning); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:999; color:white; font-weight:bold; animation: pulse 2s infinite alternate; }

    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
  </style>
</head>

<body>
  <div id="loading" class="loading-screen">
    <div style="font-size:4rem;">ğŸŒ¸</div>
    <p style="margin-top:20px;">æ­£åœ¨è§€æ¸¬å°èŠ±ä»™çš„èˆå‹•...</p>
  </div>

  <div class="status-bar">
    <div class="location-pill" id="location">ğŸ“ è‡ºåŒ—</div>
    <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
  </div>

  <div class="container" id="mainContent" style="display:none;">
    <div id="heroCard"></div>
    <h3 class="section-title">ç¨å¾Œé å ±</h3>
    <div class="scroll-container" id="futureForecasts"></div>
  </div>

  <script>
    const API_URL = "https://jenny-weather.zeabur.app/api/weather/kaohsiung";
    let currentWindDir = 1, currentWindSpeed = 1;

    function getWeatherIcon(weather) {
      if (!weather) return "ğŸŒ¸";
      if (weather.includes("æ™´")) return "ğŸŒ";
      if (weather.includes("å¤šé›²")) return "â˜ï¸";
      if (weather.includes("é™°")) return "â˜ï¸";
      if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
      if (weather.includes("é›·")) return "â›ˆï¸";
      return "ğŸŒ¸";
    }

    function getAdvice(rain,maxTemp){
      let rainIcon="ğŸŒ‚", rainText="ä¸ç”¨å¸¶å‚˜";
      if(parseInt(rain)>30){ rainIcon="â˜‚ï¸"; rainText="è¨˜å¾—å¸¶å‚˜ï¼"; }
      let clothIcon="ğŸ‘•", clothText="èˆ’é©ç©¿æ­";
      if(parseInt(maxTemp)>=28){ clothIcon="ğŸ½"; clothText="çŸ­è¢–å‡ºç™¼"; } 
      else if(parseInt(maxTemp)<=20){ clothIcon="ğŸ§¥"; clothText="åŠ ä»¶å¤–å¥—"; }
      return {rainIcon,rainText,clothIcon,clothText};
    }

    function getTimePeriod(startTime){
      const hour=new Date(startTime).getHours();
      if(hour>=5 && hour<11) return "æ—©æ™¨";
      if(hour>=11 && hour<14) return "ä¸­åˆ";
      if(hour>=14 && hour<18) return "ä¸‹åˆ";
      if(hour>=18 && hour<23) return "æ™šä¸Š";
      return "æ·±å¤œ";
    }

    function setBackground(period){
      let color="";
      switch(period){
        case "æ—©æ™¨": color="var(--pink-morning)"; break;
        case "ä¸­åˆ": color="var(--pink-noon)"; break;
        case "ä¸‹åˆ": color="var(--pink-afternoon)"; break;
        case "æ™šä¸Š": color="var(--pink-evening)"; break;
        default: color="var(--pink-morning)";
      }
      document.body.style.background=`linear-gradient(to bottom, ${color}, ${color})`;
    }

    function renderWeather(data){
      const forecasts=data.forecasts;
      const current=forecasts[0];
      const others=forecasts.slice(1);
      const advice=getAdvice(current.rain,current.maxTemp);
      const period=getTimePeriod(current.startTime);
      setBackground(period);
      currentWindSpeed = parseFloat(current.windSpeed) || 1;
      currentWindDir = (current.windDir==="è¥¿")?-1:1;

      const avgTemp=Math.round((parseInt(current.maxTemp)+parseInt(current.minTemp))/2);

      document.getElementById('heroCard').innerHTML=`
        <div class="hero-card">
          <div class="hero-period">${period}</div>
          <div class="hero-temp-container">
            <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
            <div class="hero-temp">${avgTemp}Â°</div>
          </div>
          <div class="hero-desc">${current.weather}</div>
          <div class="advice-grid">
            <div class="advice-item">
              <div class="advice-icon">${advice.rainIcon}</div>
              <div class="advice-text">${advice.rainText}</div>
              <div style="font-size:0.7rem;color:#999">é™é›¨ç‡ ${current.rain}</div>
            </div>
            <div class="advice-item">
              <div class="advice-icon">${advice.clothIcon}</div>
              <div class="advice-text">${advice.clothText}</div>
              <div style="font-size:0.7rem;color:#999">æœ€é«˜æº« ${current.maxTemp}Â°</div>
            </div>
          </div>
        </div>`;

      const scroll=document.getElementById('futureForecasts');
      scroll.innerHTML="";
      const todayDate=new Date().getDate();
      others.forEach(f=>{
        let p=getTimePeriod(f.startTime);
        const fDate=new Date(f.startTime);
        if(fDate.getDate()!==todayDate) p="æ˜å¤©"+p;
        const delay=Math.random()*1.5;
        scroll.innerHTML+=`
          <div class="mini-card">
            <div class="mini-time">${p}</div>
            <div class="mini-icon" style="animation-delay:${delay}s;">${getWeatherIcon(f.weather)}</div>
            <div class="mini-temp">${f.minTemp}Â° - ${f.maxTemp}Â°</div>
            <div style="font-size:0.8rem;color:#888;margin-top:5px;">ğŸ’§${f.rain}</div>
          </div>`;
      });

      const now=new Date();
      const month=now.getMonth()+1;
      const date=now.getDate();
      const days=["é€±æ—¥","é€±ä¸€","é€±äºŒ","é€±ä¸‰","é€±å››","é€±äº”","é€±å…­"];
      document.getElementById('updateTime').textContent=`${month}æœˆ${date}æ—¥ ${days[now.getDay()]}`;

      generateFlowerParticles(30);
    }

    async function fetchWeather(){
      try{
        const delayPromise=new Promise(resolve=>setTimeout(resolve,1500));
        const fetchPromise=fetch(API_URL).then(res=>res.json());
        const [_,json]=await Promise.all([delayPromise,fetchPromise]);
        if(json.success){
          renderWeather(json.data);
          document.getElementById('loading').style.display='none';
          document.getElementById('mainContent').style.display='block';
        } else throw new Error("API Error");
      }catch(e){
        console.error(e);
        alert("å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼Œç‹¸å…‹æŠŠç¶²è·¯ç·šå’¬æ–·äº†ï¼");
      }
    }

    function generateFlowerParticles(count){
      for(let i=0;i<count;i++){
        const flower=document.createElement('div');
        flower.className='flower-particle';
        flower.textContent='ğŸŒ¸';
        flower.style.left=Math.random()*100+'vw';
        flower.style.top=Math.random()*100+'vh';
        flower.style.fontSize=(Math.random()*20+10)+'px';
        flower.style.opacity=Math.random()*0.7+0.3;

        let speed=(Math.random()*1+0.5)*currentWindSpeed*0.5;
        let dir=currentWindDir;

        function animate(){
          let top=parseFloat(flower.style.top);
          let left=parseFloat(flower.style.left);
          top-=0.05;
          left+=dir*speed;
          if(top<-5) top=105;
          if(left>100) left=-5;
          if(left<-5) left=100;
          flower.style.top=top+'vh';
          flower.style.left=left+'vw';
          flower.style.transform=`rotate(${Math.sin(top/5)*15}deg)`;
          requestAnimationFrame(animate);
        }
        animate();
        document.body.appendChild(flower);
      }
      setInterval(()=>{ currentWindDir = Math.random()>0.5?1:-1; },1000);
    }

    document.addEventListener("DOMContentLoaded",fetchWeather);
  </script>
</body>
</html>
